function [ModelFit,Residuals,Variances] = Build_AR_GJRModel(Returns)% % % Copyright 2014 The MathWorks, Inc.%% Build Auto Regressive GJR Model%% InitializationsT         = size(Returns,1);    % # of returns (i.e., historical sample size)Model     = arima('AR', NaN, 'Distribution', 't', 'Variance', gjr(1,1));nIndices  = size(Returns,2);        % # of indicesResiduals = NaN(T, nIndices);    % preallocate storageVariances = NaN(T, nIndices);ModelFit  = cell(nIndices,1);options   = optimset('fmincon');options   = optimset(options, 'Display'  , 'off', 'Diagnostics', 'off','Algorithm', 'sqp', 'TolCon', 1e-7);%% Fit AR Model with GARCH Effects using the GJR Modelticfor i = 1:nIndices    disp(['Fitting Model #' num2str(i)])    ModelFit{i} = estimate(Model, Returns(:,i), 'options', options);    [Residuals(:,i), Variances(:,i)] = infer(ModelFit{i}, Returns(:,i));endtoc