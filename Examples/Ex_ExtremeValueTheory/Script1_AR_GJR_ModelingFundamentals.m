%% Building a GARCH Model with a GJR variance model and a t-distribution% Copyright 2014 The MathWorks, Inc.%% Load Equity IndexData         = load('Equity_MidCap.mat');Market       = Calculate_MarketCapWeightedIndex(Data.Prices,Data.FinData.MarketCap);DatesReturns = Data.Dates(2:end);Returns      = price2ret(Market);%% Check Auto Correlationfiguresubplot(2,1,1)autocorr(Returns)title('\bf ACF of Returns: Market')subplot(2,1,2)autocorr(Returns.^2)title('\bf ACF of Returns^2: Market')%% Build Modeloptions                = optimset('fmincon');options                = optimset(options, 'Display'  , 'off', 'Diagnostics', 'off','Algorithm', 'sqp', 'TolCon', 1e-7);Model                  = arima('AR', NaN, 'Distribution', 't', 'Variance', gjr(1,1));ModelFit               = estimate(Model, Returns, 'options', options);[Residuals, Variances] = infer(ModelFit, Returns);ResidualsNormalized    = Residuals ./ sqrt(Variances);%% Look at Residualsfigure, subplot(2,2,1)plot(DatesReturns,Residuals)datetick('x')xlabel('Date'), ylabel('Residual'), title ('\bf Filtered Residuals')subplot(2,2,2)plot(DatesReturns, sqrt(Variances))datetick('x')xlabel('Date'), ylabel('Volatility')title ('\bf Filtered Conditional Standard Deviations')subplot(2,2,3)autocorr(ResidualsNormalized)title('Sample ACF of Standardized Residuals')subplot(2,2,4)autocorr(ResidualsNormalized.^2)title('Sample ACF of Squared Standardized Residuals')