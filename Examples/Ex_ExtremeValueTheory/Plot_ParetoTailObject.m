function Plot_ParetoTailObject(OBJ,ei_Residuals,Names,PlotChoice)% Copyright 2014 The MathWorks, Inc.

%% Input Checkingif nargin < 4    PlotChoice = 'Semiparametric';end%% Setup Key Parametersindex = 1;tailFraction = OBJ{index}.boundary(1);minProbability = OBJ{index}.cdf((min(ei_Residuals(:,index))));maxProbability = OBJ{index}.cdf((max(ei_Residuals(:,index))));pLowerTail = linspace(minProbability  , tailFraction    , 200); % sample lower tailpUpperTail = linspace(1 - tailFraction, maxProbability  , 200); % sample upper tailpInterior  = linspace(tailFraction    , 1 - tailFraction, 200); % sample interior%% Visualizationif strcmp(PlotChoice,'Semiparametric')    figure, hold('on'), grid('on')    plot(OBJ{index}.icdf(pLowerTail), pLowerTail, 'red'  , 'LineWidth', 2)    plot(OBJ{index}.icdf(pInterior) , pInterior , 'black', 'LineWidth', 2)    plot(OBJ{index}.icdf(pUpperTail), pUpperTail, 'blue' , 'LineWidth', 2)    xlabel('Standardized Residual'), ylabel('Probability'), title('Empirical CDF')    legend({'Pareto Lower Tail' 'Kernel Smoothed Interior' ...            'Pareto Upper Tail'}, 'Location', 'NorthWest')else    figure    for index = 1:6        [P,Q] = OBJ{index}.boundary;     % cumulative probabilities & quantiles at boundaries        y     = sort(ei_Residuals(ei_Residuals(:,index) > Q(2), index) - Q(2)); % sort exceedances                subplot(3,2,index)        plot(y, (OBJ{index}.cdf(y + Q(2)) - P(2))/P(1))        hold('on');         [F,x] = ecdf(y);                 % empirical CDF        stairs(x, F, 'r'); grid('on')        legend('Fitted Generalized Pareto CDF','Empirical CDF','Location','SouthEast');        xlabel('Exceedance'); ylabel('Probability');        title(['\bf Pareto Fit: ' Names{index}])    endend